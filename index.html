<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uhrzeit</title>
  
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png"> 
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta name="theme-color" content="#000000">
    <meta name="color-scheme" content="light">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icon-192.png">
 
    <script>
      // Service Worker Registrierung
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .catch(err => console.log('SW Fehler:', err));
        });
      }
    </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&family=JetBrains+Mono:wght@400;700&display=swap');

    /* Fix für PWA-Ränder */
    html {background-color: #000000 !important;}
    
    body {
      font-family: 'Inter', sans-serif;
    }
    .modal-backdrop {
        background-color: rgba(0, 0, 0, 0.5);
    }
    .tabular-nums {
        font-variant-numeric: tabular-nums;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen flex flex-col p-4">

  <div class="flex flex-col items-center space-y-6 w-full mt-4">
    
    <div class="flex flex-col items-center space-y-4 w-full">

      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 shadow-lg flex flex-col items-center w-full max-w-sm md:max-w-lg">
        <h2 class="text-xl font-bold text-white opacity-80 text-center mb-2">Lokale Zeit</h2>
        <div id="local-clock-de" class="flex items-center justify-center text-6xl sm:text-7xl md:text-8xl font-extrabold font-mono tracking-wide text-white w-full tabular-nums">
        </div>
      </div>
      
      <div class="flex flex-col items-center bg-white/10 backdrop-blur-sm rounded-xl p-6 shadow-lg w-full max-w-sm md:max-w-lg">
        <h2 id="selected-city-title" class="text-xl font-bold text-white opacity-80 text-center mb-2">Ausgewählte Zeit</h2>
        <div id="clock" class="flex flex-col items-center justify-center text-6xl sm:text-7xl md:text-8xl font-extrabold font-mono tracking-wide text-white tabular-nums">
          </div>
        <div id="time-difference-display" class="mt-2 text-base sm:text-lg md:text-xl font-light tracking-wide text-center text-white opacity-80">
        </div>
      </div>
      
      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 shadow-lg">
        <h2 class="text-xl font-bold text-white opacity-80 text-center mb-2">Datum</h2>
        <div id="date-display" class="text-xl sm:text-2xl md:text-3xl font-light tracking-wide text-center text-white opacity-80 tabular-nums">
        </div>
      </div>
    </div>

    <div>
        <button id="timezone-selector-button" class="text-white p-3 rounded-full bg-white/20 hover:bg-white/30 transition-colors duration-200 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-white/50">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m0 0a9 9 0 019-9m-9 9a9 9 0 009 9" />
            </svg>
        </button>
    </div>
    
    <div id="timezone-modal" class="hidden fixed inset-0 flex items-center justify-center p-4 z-50 modal-backdrop">
  
  <div class="bg-white backdrop-blur-xl rounded-xl p-6 shadow-2xl flex flex-col space-y-4 max-h-[90vh] overflow-y-auto w-full max-w-[95%] sm:max-w-lg md:max-w-xl">
    
    <h3 class="text-2xl font-bold text-black mb-2">Zeitzone</h3>
    
    <div class="flex flex-col space-y-2">
        <label for="city-search-input" class="block text-xl font-bold text-black text-center">Land oder Stadt suchen</label>
        <input type="text" id="city-search-input" list="searchable-cities-list" placeholder="Name eingeben..." class="w-full p-3 text-lg text-black bg-white/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 shadow-inner" />
        <datalist id="searchable-cities-list"></datalist>
    </div>

        <div id="modal-options-container" class="flex flex-col space-y-3 pt-4 border-t border-gray-400">
          </div>

        <button id="close-modal" class="mt-4 text-white text-lg px-4 py-2 rounded-lg bg-red-500/50 hover:bg-red-500/70 transition-colors duration-200">Schließen</button>
      </div>
    </div>
  </div>

  <script type="module">
    // UI-Elemente
    const localClockDeElement = document.getElementById('local-clock-de');
    const clockElement = document.getElementById('clock');
    const timezoneSelectorButton = document.getElementById('timezone-selector-button');
    const dateElement = document.getElementById('date-display');
    const timezoneModal = document.getElementById('timezone-modal');
    const selectedCityTitleElement = document.getElementById('selected-city-title');
    const timeDifferenceElement = document.getElementById('time-difference-display');
    const modalOptionsContainer = document.getElementById('modal-options-container');
    const citySearchInput = document.getElementById('city-search-input');
    const searchableCitiesList = document.getElementById('searchable-cities-list');

    // Konstanten für spezielle Zeitzonen (optional, aber empfohlen für Lesbarkeit)
    const KIRIBATI_OST_TZ = 'Pacific/Kiritimati'; 

    // Erweiterte Datenbank mit Hauptstädten und Großstädten
    const cityToTimezoneMap = {
        'abu dhabi': 'Asia/Dubai', 'accra': 'Africa/Accra', 'alexandria': 'Africa/Cairo', 'algier': 'Africa/Algiers',
        'amman': 'Asia/Amman', 'amsterdam': 'Europe/Amsterdam', 'ankara': 'Europe/Istanbul', 'antananarivo': 'Indian/Antananarivo',
        'apia': 'Pacific/Apia', 'aschgabat': 'Asia/Ashgabat', 'asmara': 'Africa/Asmara', 'astana': 'Asia/Almaty',
        'asunción': 'America/Asuncion', 'athen': 'Europe/Athens', 'auckland': 'Pacific/Auckland', 'bagdad': 'Asia/Baghdad',
        'baku': 'Asia/Baku', 'bamako': 'Africa/Bamako', 'bangalore': 'Asia/Kolkata', 'bangkok': 'Asia/Bangkok',
        'bangui': 'Africa/Bangui', 'banjul': 'Africa/Banjul', 'barcelona': 'Europe/Madrid', 'basseterre': 'America/St_Kitts',
        'beirut': 'Asia/Beirut', 'belgrad': 'Europe/Belgrade', 'belmopan': 'America/Belize', 'berlin': 'Europe/Berlin',
        'bern': 'Europe/Zurich', 'birmingham': 'Europe/London', 'bischkek': 'Asia/Bishkek', 'bissau': 'Africa/Bissau',
        'bogotá': 'America/Bogota', 'boston': 'America/New_York', 'brasilia': 'America/Sao_Paulo',
        'bratislava': 'Europe/Bratislava', 'brazzaville': 'Africa/Brazzaville', 'bridgetown': 'America/Barbados',
        'brisbane': 'Australia/Brisbane', 'brüssel': 'Europe/Brussels', 'budapest': 'Europe/Budapest',
        'buenos aires': 'America/Argentina/Buenos_Aires', 'busan': 'Asia/Seoul', 'bukarest': 'Europe/Bucharest',
        'canberra': 'Australia/Sydney', 'caracas': 'America/Caracas', 'casablanca': 'Africa/Casablanca',
        'castries': 'America/St_Lucia', 'chennai': 'Asia/Kolkata', 'chicago': 'America/Chicago',
        'chisinau': 'Europe/Chisinau', 'chongqing': 'Asia/Shanghai', 'colombo': 'Asia/Colombo', 'conakry': 'Africa/Conakry',
        'dakar': 'Africa/Dakar', 'damaskus': 'Asia/Damascus', 'dhaka': 'Asia/Dhaka', 'dili': 'Asia/Dili',
        'dschibuti': 'Africa/Djibouti', 'dodoma': 'Africa/Dar_es_Salaam', 'doha': 'Asia/Qatar', 'dubai': 'Asia/Dubai',
        'dublin': 'Europe/Dublin', 'duschanbe': 'Asia/Dushanbe', 'eriwan': 'Asia/Yerevan', 'frankfurt': 'Europe/Berlin',
        'freetown': 'Africa/Freetown', 'funafuti': 'Pacific/Funafuti', 'gaborone': 'Africa/Gaborone', 'genf': 'Europe/Zurich',
        'georgetown': 'America/Guyana', 'glasgow': 'Europe/London', 'guadalajara': 'America/Mexico_City',
        'guangzhou': 'Asia/Shanghai', 'guatemala-stadt': 'America/Guatemala', 'hamburg': 'Europe/Berlin',
        'hanoi': 'Asia/Ho_Chi_Minh', 'harare': 'Africa/Harare', 'havanna': 'America/Havana', 'helsinki': 'Europe/Helsinki',
        'ho-chi-minh-stadt': 'Asia/Ho_Chi_Minh', 'hongkong': 'Asia/Hong_Kong', 'honiara': 'Pacific/Guadalcanal',
        'honolulu': 'Pacific/Honolulu', 'houston': 'America/Chicago', 'islamabad': 'Asia/Karachi',
        'istanbul': 'Europe/Istanbul', 'jakarta': 'Asia/Jakarta', 'jaunde': 'Africa/Douala', 'jeddah': 'Asia/Riyadh',
        'jerusalem': 'Asia/Jerusalem', 'johannesburg': 'Africa/Johannesburg', 'kabul': 'Asia/Kabul',
        'kairo': 'Africa/Cairo', 'kampala': 'Africa/Kampala', 'kapstadt': 'Africa/Johannesburg', 'karachi': 'Asia/Karachi',
        'kathmandu': 'Asia/Kathmandu', 'khartum': 'Africa/Khartoum', 'kiew': 'Europe/Kiev', 'kigali': 'Africa/Kigali',
        'kingston': 'America/Jamaica', 'kingstown': 'America/St_Vincent', 'kinshasa': 'Africa/Kinshasa',
        'kolkata': 'Asia/Kolkata', 'kopenhagen': 'Europe/Copenhagen', 'kuala lumpur': 'Asia/Kuala_Lumpur',
        'kuwait-stadt': 'Asia/Kuwait', 'köln': 'Europe/Berlin', 'la paz': 'America/La_Paz', 'lagos': 'Africa/Lagos',
        'las vegas': 'America/Los_Angeles', 'libreville': 'Africa/Libreville', 'lilongwe': 'Africa/Blantyre',
        'lima': 'America/Lima', 'lissabon': 'Europe/Lisbon', 'ljubljana': 'Europe/Ljubljana', 'lomé': 'Africa/Lome',
        'london': 'Europe/London', 'los angeles': 'America/Los_Angeles', 'luanda': 'Africa/Luanda',
        'lusaka': 'Africa/Lusaka', 'luxemburg': 'Europe/Luxembourg', 'lyon': 'Europe/Paris', 'madrid': 'Europe/Madrid',
        'mailand': 'Europe/Rome', 'majuro': 'Pacific/Majuro', 'malabo': 'Africa/Malabo', 'malé': 'Indian/Maldives',
        'manchester': 'Europe/London', 'managua': 'America/Managua', 'manama': 'Asia/Bahrain', 'manila': 'Asia/Manila',
        'maputo': 'Africa/Maputo', 'marseille': 'Europe/Paris', 'maseru': 'Africa/Maseru', 'mbabane': 'Africa/Mbabane',
        'medellín': 'America/Bogota', 'mekka': 'Asia/Riyadh', 'melbourne': 'Australia/Melbourne',
        'mexiko-stadt': 'America/Mexico_City', 'miami': 'America/New_York', 'minsk': 'Europe/Minsk',
        'mogadischu': 'Africa/Mogadishu', 'monaco': 'Europe/Monaco', 'monrovia': 'Africa/Monrovia',
        'montevideo': 'America/Montevideo', 'montreal': 'America/Toronto', 'moroni': 'Indian/Comoro',
        'moskau': 'Europe/Moscow', 'mumbai': 'Asia/Kolkata', 'maskat': 'Asia/Muscat', 'münchen': 'Europe/Berlin',
        'nairobi': 'Africa/Nairobi', 'nassau': 'America/Nassau', 'naypyidaw': 'Asia/Yangon',
        'n’djamena': 'Africa/Ndjamena', 'neapel': 'Europe/Rome', 'neu-delhi': 'Asia/Kolkata', 'new york': 'America/New_York',
        'ngerulmud': 'Pacific/Palau', 'niamey': 'Africa/Niamey', 'nikosia': 'Asia/Nicosia',
        'nouakchott': 'Africa/Nouakchott', 'nuku alofa': 'Pacific/Tongatapu', 'osaka': 'Asia/Tokyo', 'oslo': 'Europe/Oslo',
        'ottawa': 'America/Toronto', 'ouagadougou': 'Africa/Ouagadougou', 'palikir': 'Pacific/Pohnpei',
        'panama-stadt': 'America/Panama', 'paramaribo': 'America/Paramaribo', 'paris': 'Europe/Paris',
        'peking': 'Asia/Shanghai', 'perth': 'Australia/Perth', 'phnom penh': 'Asia/Phnom_Penh',
        'pjöngjang': 'Asia/Pyongyang', 'podgorica': 'Europe/Podgorica', 'port louis': 'Indian/Mauritius',
        'port moresby': 'Pacific/Port_Moresby', 'port-au-prince': 'America/Port-au-Prince',
        'port of spain': 'America/Port_of_Spain', 'port vila': 'Pacific/Efate', 'prag': 'Europe/Prague',
        'praia': 'Atlantic/Cape_Verde', 'pretoria': 'Africa/Johannesburg', 'quito': 'America/Guayaquil',
        'rabat': 'Africa/Casablanca', 'reykjavik': 'Atlantic/Reykjavik', 'riga': 'Europe/Riga', 'riad': 'Asia/Riyadh',
        'rio de janeiro': 'America/Sao_Paulo', 'rom': 'Europe/Rome', 'roseau': 'America/Dominica',
        'san francisco': 'America/Los_Angeles', 'san josé': 'America/Costa_Rica', 'san marino': 'Europe/San_Marino',
        'san salvador': 'America/El_Salvador', 'sanaa': 'Asia/Aden', 'sankt petersburg': 'Europe/Moscow',
        'santiago': 'America/Santiago', 'santo domingo': 'America/Santo_Domingo', 'são tomé': 'Africa/Sao_Tome',
        'sarajevo': 'Europe/Sarajevo', 'seattle': 'America/Los_Angeles', 'seoul': 'Asia/Seoul',
        'shanghai': 'Asia/Shanghai', 'shenzhen': 'Asia/Shanghai', 'singapur': 'Asia/Singapore', 'skopje': 'Europe/Skopje',
        'sofia': 'Europe/Sofia', 'st. george\'s': 'America/Grenada', 'st. john\'s': 'America/Antigua',
        'stockholm': 'Europe/Stockholm', 'suva': 'Pacific/Fiji', 'sydney': 'Australia/Sydney', 'taipeh': 'Asia/Taipei',
        'tallinn': 'Europe/Tallinn', 'tarawa': 'Pacific/Tarawa', 'taschkent': 'Asia/Tashkent',
        'tiflis': 'Asia/Tbilisi', 'tegucigalpa': 'America/Tegucigalpa', 'teheran': 'Asia/Tehran',
        'thimphu': 'Asia/Thimphu', 'tirana': 'Europe/Tirana', 'tokio': 'Asia/Tokyo', 'toronto': 'America/Toronto',
        'tripolis': 'Africa/Tripoli', 'tunis': 'Africa/Tunis', 'ulaanbaatar': 'Asia/Ulaanbaatar',
        'vaduz': 'Europe/Vaduz', 'valletta': 'Europe/Malta', 'vancouver': 'America/Vancouver',
        'vatikanstadt': 'Europe/Vatican', 'victoria': 'Indian/Mahe', 'vientiane': 'Asia/Vientiane',
        'vilnius': 'Europe/Vilnius', 'warschau': 'Europe/Warsaw', 'washington dc': 'America/New_York',
        'wellington': 'Pacific/Auckland', 'wien': 'Europe/Vienna', 'windhoek': 'Africa/Windhoek',
        'yokohama': 'Asia/Tokyo', 'zagreb': 'Europe/Zagreb', 'zürich': 'Europe/Zurich',
        'anchorage': 'America/Anchorage','lagos': 'Africa/Lagos','nuuk': 'America/Nuuk','tel aviv': 'Asia/Jerusalem',
        'kanarische inseln': 'Atlantic/Canary', 'kiribati ost': 'Pacific/Kiritimati', 'samoa': 'Pacific/Pago_Pago',
        'surat': 'Asia/Kolkata','izmir': 'Europe/Istanbul','nagoya': 'Asia/Tokyo','phoenix': 'America/Phoenix',
        'guayaquil': 'America/Guayaquil','monterrey': 'America/Monterrey','adelaide': 'Australia/Adelaide',
        'darwin': 'Australia/Darwin','antalya': 'Europe/Istanbul','cancun': 'America/Cancun',
        'phuket': 'Asia/Bangkok','pattaya': 'Asia/Bangkok','dresden': 'Europe/Berlin',
        'leipzig': 'Europe/Berlin','luebeck': 'Europe/Berlin','heidelberg': 'Europe/Berlin',
        'binz': 'Europe/Berlin','rust': 'Europe/Berlin','venedig': 'Europe/Rome',
        'kyoto': 'Asia/Tokyo','palma': 'Europe/Madrid','mallorca': 'Europe/Madrid',
        'stadtbergen': 'Europe/Berlin','baikonur': 'Asia/Almaty','cape canaveral': 'America/New_York',
        'kourou': 'America/Cayenne','tanegashima': 'Asia/Tokyo',

      /* --- Länder-Liste (Ein-Zeitzonen-Länder) --- */
'afghanistan': 'Asia/Kabul',
'ägypten': 'Africa/Cairo',
'albanien': 'Europe/Tirane',
'algerien': 'Africa/Algiers',
'andorra': 'Europe/Andorra',
'angola': 'Africa/Luanda',
'antigua und barbuda': 'America/Antigua',
'äquatorialguinea': 'Africa/Malabo',
'argentinien': 'America/Argentina/Buenos_Aires',
'armenien': 'Asia/Yerevan',
'aserbaidschan': 'Asia/Baku',
'äthiopien': 'Africa/Addis_Ababa',
'bahamas': 'America/Nassau',
'bahrain': 'Asia/Bahrain',
'bangladesch': 'Asia/Dhaka',
'barbados': 'America/Barbados',
'belgien': 'Europe/Brussels',
'belize': 'America/Belize',
'benin': 'Africa/Porto-Novo',
'bhutan': 'Asia/Thimphu',
'bolivien': 'America/La_Paz',
'bosnien und herzegowina': 'Europe/Sarajevo',
'botswana': 'Africa/Gaborone',
'brunei': 'Asia/Brunei',
'bulgarien': 'Europe/Sofia',
'burkina faso': 'Africa/Ouagadougou',
'burundi': 'Africa/Bujumbura',
'china': 'Asia/Shanghai',
'costa rica': 'America/Costa_Rica',
'deutschland': 'Europe/Berlin',
'dominica': 'America/Dominica',
'dominikanische republik': 'America/Santo_Domingo',
'dschibuti': 'Africa/Djibouti',
'el salvador': 'America/El_Salvador',
'elfenbeinküste': 'Africa/Abidjan',
'eritrea': 'Africa/Asmara',
'estland': 'Europe/Tallinn',
'eswatini': 'Africa/Mbabane',
'fidschi': 'Pacific/Fiji',
'finnland': 'Europe/Helsinki',
'frankreich': 'Europe/Paris',
'gabun': 'Africa/Libreville',
'gambia': 'Africa/Banjul',
'georgien': 'Asia/Tbilisi',
'ghana': 'Africa/Accra',
'grenada': 'America/Grenada',
'griechenland': 'Europe/Athens',
'guatemala': 'America/Guatemala',
'guinea': 'Africa/Conakry',
'guinea-bissau': 'Africa/Bissau',
'guyana': 'America/Guyana',
'haiti': 'America/Port-au-Prince',
'honduras': 'America/Tegucigalpa',
'indien': 'Asia/Kolkata',
'irak': 'Asia/Baghdad',
'iran': 'Asia/Tehran',
'irland': 'Europe/Dublin',
'island': 'Atlantic/Reykjavik',
'israel': 'Asia/Jerusalem',
'italien': 'Europe/Rome',
'jamaika': 'America/Jamaica',
'japan': 'Asia/Tokyo',
'jemen': 'Asia/Aden',
'jordanien': 'Asia/Amman',
'kambodscha': 'Asia/Phnom_Penh',
'kamerun': 'Africa/Douala',
'katar': 'Asia/Qatar',
'kenia': 'Africa/Nairobi',
'kolumbien': 'America/Bogota',
'komoren': 'Indian/Comoro',
'kroatien': 'Europe/Zagreb',
'kuba': 'America/Havana',
'kuwait': 'Asia/Kuwait',
'laos': 'Asia/Vientiane',
'lesotho': 'Africa/Maseru',
'lettland': 'Europe/Riga',
'libanon': 'Asia/Beirut',
'liberia': 'Africa/Monrovia',
'libyen': 'Africa/Tripoli',
'liechtenstein': 'Europe/Vaduz',
'litauen': 'Europe/Vilnius',
'luxemburg': 'Europe/Luxembourg',
'madagaskar': 'Indian/Antananarivo',
'malawi': 'Africa/Blantyre',
'malaysia': 'Asia/Kuala_Lumpur',
'malediven': 'Indian/Maldives',
'mali': 'Africa/Bamako',
'malta': 'Europe/Malta',
'marokko': 'Africa/Casablanca',
'mauretanien': 'Africa/Nouakchott',
'mauritius': 'Indian/Mauritius',
'mexiko': 'America/Mexico_City',
'moldau': 'Europe/Chisinau',
'monaco': 'Europe/Monaco',
'montenegro': 'Europe/Podgorica',
'mosambik': 'Africa/Maputo',
'myanmar': 'Asia/Yangon',
'namibia': 'Africa/Windhoek',
'nepal': 'Asia/Kathmandu',
'nicaragua': 'America/Managua',
'niederlande': 'Europe/Amsterdam',
'niger': 'Africa/Niamey',
'nigeria': 'Africa/Lagos',
'nordkorea': 'Asia/Pyongyang',
'nordmazedonien': 'Europe/Skopje',
'norwegen': 'Europe/Oslo',
'oman': 'Asia/Muscat',
'österreich': 'Europe/Vienna',
'pakistan': 'Asia/Karachi',
'panama': 'America/Panama',
'paraguay': 'America/Asuncion',
'peru': 'America/Lima',
'philippinen': 'Asia/Manila',
'polen': 'Europe/Warsaw',
'portugal': 'Europe/Lisbon',
'ruanda': 'Africa/Kigali',
'rumänien': 'Europe/Bucharest',
'sambia': 'Africa/Lusaka',
'san marino': 'Europe/San_Marino',
'saudi-arabien': 'Asia/Riyadh',
'schweden': 'Europe/Stockholm',
'schweiz': 'Europe/Zurich',
'senegal': 'Africa/Dakar',
'serbien': 'Europe/Belgrade',
'seychellen': 'Indian/Mahe',
'sierra leone': 'Africa/Freetown',
'simbabwe': 'Africa/Harare',
'singapur': 'Asia/Singapore',
'slowakei': 'Europe/Bratislava',
'slowenien': 'Europe/Ljubljana',
'somalia': 'Africa/Mogadishu',
'spanien': 'Europe/Madrid',
'sri lanka': 'Asia/Colombo',
'südafrika': 'Africa/Johannesburg',
'sudan': 'Africa/Khartoum',
'südkorea': 'Asia/Seoul',
'südsudan': 'Africa/Juba',
'syrien': 'Asia/Damascus',
'tadschikistan': 'Asia/Dushanbe',
'taiwan': 'Asia/Taipei',
'tansania': 'Africa/Dar_es_Salaam',
'thailand': 'Asia/Bangkok',
'togo': 'Africa/Lome',
'tschechien': 'Europe/Prague',
'tunesien': 'Africa/Tunis',
'türkei': 'Europe/Istanbul',
'turkmenistan': 'Asia/Ashgabat',
'uganda': 'Africa/Kampala',
'ukraine': 'Europe/Kyiv',
'ungarn': 'Europe/Budapest',
'uruguay': 'America/Montevideo',
'usbekistan': 'Asia/Tashkent',
'vatikanstadt': 'Europe/Vatican',
'venezuela': 'America/Caracas',
'vereinigte arabische emirate': 'Asia/Dubai',
'vietnam': 'Asia/Ho_Chi_Minh',
'zypern': 'Asia/Nicosia',

'grönland': 'America/Nuuk',
'nauru': 'Pacific/Nauru',
'mikronesien': 'Pacific/Pohnpei',
'marshallinseln': 'Pacific/Majuro',
'yaren': 'Pacific/Nauru',  
'funafuti': 'Pacific/Funafuti', 
'palästina': 'Asia/Gaza', 
'gaza': 'Asia/Gaza',
'praia': 'Atlantic/Cape_Verde',
'kapverden': 'Atlantic/Cape_Verde',
'dschuba': 'Africa/Juba',
'majuro': 'Pacific/Majuro',
'osttimor': 'Asia/Dili',
'timor-leste': 'Asia/Dili',
'vanuatu': 'Pacific/Efate',
      
/* --- Länder mit mehreren Zeitzonen (West nach Ost) --- */

// USA (Hauptzonen)
'usa zone 1': 'America/Los_Angeles', // Pacific
'usa zone 2': 'America/Denver',      // Mountain
'usa zone 3': 'America/Chicago',     // Central
'usa zone 4': 'America/New_York',    // Eastern
'usa alaska': 'America/Anchorage',
'usa hawaii': 'Pacific/Honolulu',

// Kanada
'kanada zone 1': 'America/Vancouver',
'kanada zone 2': 'America/Edmonton',
'kanada zone 3': 'America/Winnipeg',
'kanada zone 4': 'America/Toronto',
'kanada zone 5': 'America/Halifax',
'kanada zone 6': 'America/St_Johns',

// Russland (Auswahl der wichtigsten Zonen)
'russland zone 1': 'Europe/Kaliningrad',
'russland zone 2': 'Europe/Moscow',
'russland zone 3': 'Europe/Samara',
'russland zone 4': 'Asia/Yekaterinburg',
'russland zone 5': 'Asia/Omsk',
'russland zone 6': 'Asia/Krasnoyarsk',
'russland zone 7': 'Asia/Irkutsk',
'russland zone 8': 'Asia/Yakutsk',
'russland zone 9': 'Asia/Vladivostok',
'russland zone 10': 'Asia/Magadan',
'russland zone 11': 'Asia/Anadyr',

// Australien
'australien zone 1': 'Australia/Perth',
'australien zone 2': 'Australia/Adelaide',
'australien zone 3': 'Australia/Sydney',

// Brasilien
'brasilien zone 1': 'America/Rio_Branco',
'brasilien zone 2': 'America/Manaus',
'brasilien zone 3': 'America/Sao_Paulo',
'brasilien zone 4': 'America/Noronha',

// Indonesien
'indonesien zone 1': 'Asia/Jakarta',
'indonesien zone 2': 'Asia/Makassar',
'indonesien zone 3': 'Asia/Jayapura',
    
    };
    
    // Kuratierte Liste für Buttons
    const geographicTimezones = [
        { name: 'Berlin', timezone: 'Europe/Berlin' }, 
        { name: 'Kiribati Ost *', timezone: KIRIBATI_OST_TZ }, 
        { name: 'Amerik. Samoa *', timezone: 'Pacific/Pago_Pago' }, 
         ];
    const specialTimezones = [
        { name: 'Astrozeit (Stadtb.)', timezone: 'astro' }, { name: 'MEZ', timezone: 'MEZ' },
        { name: 'MESZ', timezone: 'MESZ' }, { name: 'UTC / GMT', timezone: 'Etc/UTC' },
        { name: 'WOZ (Stadtb.)', timezone: 'wot' },
    ];
    
    geographicTimezones.sort((a, b) => a.name.localeCompare(b.name));
    specialTimezones.sort((a, b) => a.name.localeCompare(b.name));

    let selectedTimezone = localStorage.getItem('selectedTimezone') || 'Europe/Berlin';
    let selectedCityName = localStorage.getItem('selectedCityName') || 'Berlin';
    
    function createModalButtons() {
        modalOptionsContainer.innerHTML = '';
        const geographicHeading = document.createElement('h4');
        geographicHeading.className = "text-xl font-bold text-black text-center";
        geographicHeading.textContent = "Häufige Zeitzonen";
        modalOptionsContainer.appendChild(geographicHeading);

        const geographicContainer = document.createElement('div');
        geographicContainer.className = "grid grid-cols-1 sm:grid-cols-2 gap-2";
        modalOptionsContainer.appendChild(geographicContainer);

        geographicTimezones.forEach(option => {
            const button = document.createElement('button');
            button.className = "modal-option text-black text-lg px-4 py-2 rounded-lg bg-indigo-500/50 hover:bg-indigo-500/70 transition-colors duration-200";
            button.textContent = option.name;
            button.dataset.timezone = option.timezone;
            button.dataset.cityName = option.name.replace(' *', ''); // Speichern des Namens ohne *
            geographicContainer.appendChild(button);
        });
        
        const separator = document.createElement('div');
        separator.className = "w-full h-1 my-4 bg-gray-400 rounded-full";
        modalOptionsContainer.appendChild(separator);
        
        const specialHeading = document.createElement('h4');
        specialHeading.className = "text-xl font-bold text-black text-center";
        specialHeading.textContent = "Spezielle Zeitzonen";
        modalOptionsContainer.appendChild(specialHeading);

        const specialContainer = document.createElement('div');
        specialContainer.className = "grid grid-cols-1 sm:grid-cols-2 gap-2";
        modalOptionsContainer.appendChild(specialContainer);

        specialTimezones.forEach(option => {
            const button = document.createElement('button');
            button.className = "modal-option text-black text-lg px-4 py-2 rounded-lg bg-yellow-500/50 hover:bg-yellow-500/70 transition-colors duration-200";
            button.textContent = option.name;
            button.dataset.timezone = option.timezone;
            button.dataset.cityName = option.name.replace(' *', '');
            specialContainer.appendChild(button);
        });
    }
    
    function populateSearchableCitiesList() {
        searchableCitiesList.innerHTML = '';
        Object.keys(cityToTimezoneMap).sort().forEach(cityKey => {
            const option = document.createElement('option');
            option.value = cityKey.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            searchableCitiesList.appendChild(option);
        });
    }


    function saveTimezone(timezone, cityName) {
        localStorage.setItem('selectedTimezone', timezone);
        localStorage.setItem('selectedCityName', cityName);
        selectedTimezone = timezone;
        selectedCityName = cityName;
    }
    
    // KORRIGIERTE FUNKTION: Ermittelt den aktuellen UTC-Offset in Stunden (robustere IANA-Erkennung)
    function getOffsetHours(timezone) {
        // Manuelle Offsets beibehalten:
        if (timezone === 'MEZ') return 1;
        if (timezone === 'MESZ') return 2;
        if (timezone === 'wot' || timezone === 'astro') return null; // Keine Stunden-Differenz
        
        // Fallback für lokale Zeitzone (sollte den Offset über IANA-Abfrage im try-Block ermitteln)
        if (timezone === Intl.DateTimeFormat().resolvedOptions().timeZone) {
             // Wenn Intl nicht funktioniert, der manuelle Browser-Offset
             try {
                // Versucht, den Offset dynamisch zu ermitteln, bevor auf getTimezoneOffset zurückgegriffen wird
                return getOffsetHoursDynamic(timezone); 
             } catch (e) {
                return new Date().getTimezoneOffset() / -60;
             }
        }

        // Dynamische IANA-Abfrage für alle anderen Zeitzonen
        return getOffsetHoursDynamic(timezone);
    }
    
    function getOffsetHoursDynamic(timezone) {
        try {
            const date = new Date();
            const formatter = new Intl.DateTimeFormat('en-US', {
                timeZone: timezone,
                timeZoneName: 'shortOffset',
                hour: '2-digit'
            });
            
            const parts = formatter.formatToParts(date);
            // Sucht nach dem Zeitzonen-Namen, der GMT/UTC enthält
            const offsetPart = parts.find(p => p.type === 'timeZoneName' && (p.value.startsWith('GMT') || p.value.startsWith('UTC')));
            
            if (offsetPart) {
                const offsetString = offsetPart.value;
                // Extrahiert den numerischen Offset-Teil
                const match = offsetString.match(/([+-]\d{1,2}(:\d{2})?)/);

                if (match) {
                    const offset = match[1];
                    if (offset.includes(':')) {
                        // Behandelt Minuten-Offsets (z.B. +5:30)
                        const parts = offset.match(/([+-])(\d{1,2}):(\d{2})/);
                        if (parts) {
                            const sign = parts[1] === '-' ? -1 : 1;
                            const h = Number(parts[2]);
                            const m = Number(parts[3]);
                            return sign * (h + m / 60);
                        }
                    }
                    // Fängt einfache Offsets wie +10 oder -5 ab
                    return Number(offset);
                } 
                
                // Wenn der String nur "GMT" oder "UTC" ist (Offset 0)
                if (offsetString === 'GMT' || offsetString === 'UTC' || offsetString === 'Z') {
                    return 0;
                }
            }
        } catch (e) {
            console.error(`Fehler bei der Offset-Ermittlung für ${timezone}:`, e);
        }
        
        return null; // Wenn alles fehlschlägt
    }

    // Funktion: Berechnet die Differenz basierend auf den UTC-Offsets
    function calculateTimeDifference() {
        // Sicherstellen, dass die lokale Zeitzone als IANA-String vorliegt
        const localTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone; 
        
        // Ruft den dynamischen Offset von der lokalen Zeitzone ab (z.B. 1 für MEZ)
        const localOffset = getOffsetHours(localTimezone); 
        
        // Ruft den dynamischen Offset der ausgewählten Zeitzone ab (z.B. 0 für London/GMT)
        const selectedOffset = getOffsetHours(selectedTimezone);

        if (selectedOffset === null || localOffset === null || selectedTimezone === 'wot' || selectedTimezone === 'astro') {
            return ''; // Keine Differenzangabe für spezielle oder unbekannte Zonen
        }

        let diffHoursFloat = selectedOffset - localOffset;

        // Führt eine Rundung auf die nächste Minute durch, um Fließkommafehler zu vermeiden
        const totalDiffMinutes = Math.round(diffHoursFloat * 60);
        
        let diffHours = Math.trunc(totalDiffMinutes / 60);
        let diffMins = Math.abs(totalDiffMinutes % 60);

        if (diffHours === 0 && diffMins === 0) return 'Gleiche Zeit';

        const absHours = Math.abs(diffHours);
        const absMins = Math.abs(diffMins);
        const sign = (diffHours < 0 || (diffHours === 0 && totalDiffMinutes < 0)) ? 'zurück' : 'voraus';

        let diffParts = [];
        if (absHours > 0) diffParts.push(`${absHours} Stunde${absHours === 1 ? '' : 'n'}`);
        if (absMins > 0) diffParts.push(`${absMins} Minute${absMins === 1 ? '' : 'n'}`);

        return `${diffParts.join(' und ')} ${sign}`;
    }

    function getUTCOffsetString(timezone) {
      if (timezone === 'MEZ') return '(UTC+1)';
      if (timezone === 'MESZ') return '(UTC+2)';
      if (timezone === 'wot') return '<br>(Wahre Ortszeit)';
      if (timezone === 'astro') return '(GMST)';
      // Dynamische Abfrage für alle IANA-Zonen
      try {
        const offsetString = new Date().toLocaleTimeString('en-US', { timeZone: timezone, timeZoneName: 'shortOffset' });
        const match = offsetString.match(/(GMT|UTC)([+-]\d{1,2}(:\d{2})?)/);
        if (match) return `(UTC${match[2]})`;
        // Wenn kein numerischer Offset, aber 'GMT' oder 'UTC' angezeigt wird
        if (offsetString.includes('GMT') || offsetString.includes('UTC')) return '(UTC+0)';
      } catch (e) { /* Fehler ignorieren */ }
      return '';
    }

    function updateLocalClock() {
      const timeStringDe = new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
      if (localClockDeElement) localClockDeElement.textContent = timeStringDe;
    }
    
    // KORRIGIERTE FUNKTION: Entfernt die manuelle Berechnung für Pacific/Kiritimati
    function updateTimeAndDate() {
      const now = new Date();
      let timeString = '', dateString = '';
      const locale = 'de-DE';

      if (selectedTimezone === 'wot') {
        const longitude = 10.839; 
        const now2 = new Date();
        const start = new Date(now2.getFullYear(), 0, 0);
        const diff = now2 - start;
        const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
        const b = (2 * Math.PI * (dayOfYear - 81)) / 365;
        const eot = 9.87 * Math.sin(2 * b) - 7.53 * Math.cos(b) - 1.5 * Math.sin(b);
        const totalCorrectionMinutes = (longitude * 4) + eot;
        const utcTimestamp = now.getTime() + (now.getTimezoneOffset() * 60000);
        const wotDate = new Date(utcTimestamp + (totalCorrectionMinutes * 60000));
        timeString = `${String(wotDate.getHours()).padStart(2, '0')}:${String(wotDate.getMinutes()).padStart(2, '0')}:${String(wotDate.getSeconds()).padStart(2, '0')}`;
        dateString = now.toLocaleDateString(locale, { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });
      } else if (selectedTimezone === 'astro') {
        const longitude = 10.839; // Stadtbergen
        const jd = (now.getTime() / 86400000) + 2440587.5;
        const d = jd - 2451545.0;
        let gmst = (18.697374558 + 24.06570982441908 * d) % 24;
        let lst = (gmst + (longitude / 15)) % 24; // Korrektur von Greenwich auf Stadtbergen
        if (lst < 0) lst += 24;
        const h = Math.floor(lst), m = Math.floor((lst - h) * 60), s = Math.floor(((lst - h) * 60 - m) * 60);
        const f = (v) => String(v).padStart(2, '0');
        timeString = `${f(h)}:${f(m)}:${f(s)}`;
        dateString = now.toLocaleDateString(locale, { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric' });
      } else if (selectedTimezone === 'MEZ' || selectedTimezone === 'MESZ') {
        const offsetHours = selectedTimezone === 'MEZ' ? 1 : 2;
        const date = new Date(now.getTime() + (offsetHours * 60 * 60 * 1000));
        timeString = `${String(date.getUTCHours()).padStart(2, '0')}:${String(date.getUTCMinutes()).padStart(2, '0')}:${String(date.getUTCSeconds()).padStart(2, '0')}`;
        dateString = date.toLocaleDateString(locale, { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric', timeZone: 'Etc/UTC' });
      } else {
        timeString = now.toLocaleTimeString(locale, { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: selectedTimezone, hour12: false });
        dateString = now.toLocaleDateString(locale, { weekday: 'long', day: '2-digit', month: '2-digit', year: 'numeric', timeZone: selectedTimezone });
      }

      if (selectedCityTitleElement) selectedCityTitleElement.textContent = selectedCityName;
      if (clockElement) clockElement.innerHTML = timeString;
      if (dateElement) dateElement.textContent = dateString;
      
      const diffText = calculateTimeDifference(); 
      const utcOffsetText = getUTCOffsetString(selectedTimezone);

      if (timeDifferenceElement) timeDifferenceElement.innerHTML = `${diffText} ${utcOffsetText}`;
    }
    
    // Event-Listener
    timezoneSelectorButton.addEventListener('click', () => {
        citySearchInput.value = '';
        createModalButtons();
        populateSearchableCitiesList();
        timezoneModal.classList.remove('hidden');
        citySearchInput.focus();
    });
    
    citySearchInput.addEventListener('input', (e) => {
        const val = e.target.value.toLowerCase();
        if (cityToTimezoneMap[val]) {
            saveTimezone(cityToTimezoneMap[val], e.target.value);
            updateTimeAndDate();
            setTimeout(() => { 
                timezoneModal.classList.add('hidden'); 
                citySearchInput.value = ''; 
            }, 300);
        }
    });

    document.getElementById('close-modal').addEventListener('click', () => timezoneModal.classList.add('hidden'));

    modalOptionsContainer.addEventListener('click', (e) => {
        const option = e.target.closest('.modal-option');
        if (option) {
            // Entfernt das Sternchen, bevor der Name gespeichert wird
            saveTimezone(option.dataset.timezone, option.dataset.cityName); 
            updateTimeAndDate();
            timezoneModal.classList.add('hidden');
        }
    });

    // Initialisierung
    setInterval(() => {
        updateLocalClock();
        updateTimeAndDate();
    }, 1000);
    updateLocalClock();
    updateTimeAndDate();
  </script>

</body>
</html>
